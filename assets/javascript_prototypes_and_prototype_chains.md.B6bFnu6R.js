import{_ as s,c as o,o as t,ag as n}from"./chunks/framework.D-6U7MZ9.js";const a="/n-book/assets/prototype_0.DfUZisER.png",p="/n-book/assets/prototype_1.DBOThphu.png",r="/n-book/assets/prototype_2.D1VMFJGW.png",l="/n-book/assets/prototype_3.MUBkKqET.png",c="/n-book/assets/prototype_4.BGKTQqVh.png",i="/n-book/assets/prototype_5._72FT9bY.png",v=JSON.parse('{"title":"Prototypes and prototype chains (原型与原型链)","description":"","frontmatter":{},"headers":[],"relativePath":"javascript/prototypes_and_prototype_chains.md","filePath":"javascript/prototypes_and_prototype_chains.md","lastUpdated":1552905432000}'),d={name:"javascript/prototypes_and_prototype_chains.md"};function y(h,e,b,u,m,f){return t(),o("div",null,e[0]||(e[0]=[n(`<h1 id="prototypes-and-prototype-chains-原型与原型链" tabindex="-1">Prototypes and prototype chains (原型与原型链) <a class="header-anchor" href="#prototypes-and-prototype-chains-原型与原型链" aria-label="Permalink to &quot;Prototypes and prototype chains (原型与原型链)&quot;">​</a></h1><p>这篇文章主要解决两个问题：</p><ol><li>what’s prototype chains? and how prototype object chains allow objects to inherit features from one another? (什么是原型链？以及原型对象链如何允许一个对象从另一个对象中继承其特性？)</li><li>what’s the prototype property? and how the prototype property can be used to add methods to existing constructors? (原型属性是什么？以及如何使用原型属性向现有构造函数添加方法？)</li></ol><h2 id="定义" tabindex="-1">定义 <a class="header-anchor" href="#定义" aria-label="Permalink to &quot;定义&quot;">​</a></h2><blockquote><p>JavaScript is often described as a prototype-based language — <strong>each object has a prototype object</strong>, which acts as a template object that it inherits methods and properties from. An object&#39;s prototype object may also have a prototype object, which it inherits methods and properties from, and so on. This is often referred to as a <code>prototype chain</code>, and explains why different objects have properties and methods defined on other objects available to them.</p></blockquote><p><strong>To be exact, the properties and methods are defined on the prototype property on the Objects&#39; constructor functions, not the object instances themselves.</strong></p><p>In JavaScript, a link is made between the object instance and its prototype (its <code>__proto__</code> property, which is derived from the prototype property on the constructor), and the properties and methods are found by walking up the chain of prototypes.</p><div class="warning custom-block"><p class="custom-block-title">Note</p><p>It&#39;s important to understand that there is a distinction between an <strong>object&#39;s prototype</strong> (which is available via <code>Object.getPrototypeOf(obj)</code>, or via the deprecated <strong>proto</strong> property) and <strong>the prototype property on constructor functions</strong>. The former is the property on each instance, and the latter is the property on the constructor. That is, <code>Object.getPrototypeOf(new Foobar())</code> refers to the same object as <code>Foobar.prototype</code>.</p></div><h2 id="understanding-prototype-objects" tabindex="-1">Understanding prototype objects <a class="header-anchor" href="#understanding-prototype-objects" aria-label="Permalink to &quot;Understanding prototype objects&quot;">​</a></h2><p>Let&#39;s look at an example to make this a bit clearer: In this example, we have defined a constructor function, like so:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E67E80;">function</span><span style="color:#A7C080;"> Person</span><span style="color:#D3C6AA;">(first,</span><span style="color:#D3C6AA;"> last,</span><span style="color:#D3C6AA;"> age,</span><span style="color:#D3C6AA;"> gender,</span><span style="color:#D3C6AA;"> interests)</span><span style="color:#D3C6AA;"> {</span><span style="color:#A7C080;">  </span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // property and method definitions</span></span>
<span class="line"><span style="color:#D699B6;">  this</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">first</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> first;</span></span>
<span class="line"><span style="color:#D699B6;">  this</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">last</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> last;</span></span>
<span class="line"><span style="color:#D3C6AA;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>We have then created an object instance like this:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E69875;">var</span><span style="color:#D3C6AA;"> person1 </span><span style="color:#E69875;">=</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Person</span><span style="color:#D3C6AA;">(</span><span style="color:#DBBC7F;">&#39;Bob&#39;</span><span style="color:#D3C6AA;">, </span><span style="color:#DBBC7F;">&#39;Smith&#39;</span><span style="color:#D3C6AA;">, </span><span style="color:#D699B6;">32</span><span style="color:#D3C6AA;">, </span><span style="color:#DBBC7F;">&#39;male&#39;</span><span style="color:#D3C6AA;">, [</span><span style="color:#DBBC7F;">&#39;music&#39;</span><span style="color:#D3C6AA;">, </span><span style="color:#DBBC7F;">&#39;skiing&#39;</span><span style="color:#D3C6AA;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>This demonstrates the prototype chain working. <img src="`+a+'" alt="prototype_0"></p><p>So what happens if you call a method on person1, which is actually defined on Object? For example:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#D3C6AA;">person1</span><span style="color:#859289;">.</span><span style="color:#A7C080;">valueOf</span><span style="color:#D3C6AA;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>This method simply returns the value of the object it is called on — try it and see! In this case, what happens is:</p><ol><li>The browser initially checks to see if the <code>person1</code> object has a <code>valueOf()</code> method available on it.</li><li>It doesn&#39;t, so the browser then checks to see if the <code>person1 object&#39;s prototype object</code> (Person() constructor&#39;s prototype) has a <code>valueOf()</code> method available on it.</li><li>It doesn&#39;t either, so the browser then checks to see if the <code>Person() constructor&#39;s prototype object&#39;s prototype object </code>(Object() constructor&#39;s prototype) has a <code>valueOf()</code> method available on it. It does, so it is called, and all is good!</li></ol><div class="warning custom-block"><p class="custom-block-title">Note</p><p>There isn&#39;t officially a way to access an object&#39;s prototype object directly — the &quot;links&quot; between the items in the chain are defined in an internal property, referred to as <code>[[prototype]]</code> in the specification for the JavaScript language. Most modern browsers however do have a property available on them called <code>__proto__ </code>, which contains the object&#39;s constructor&#39;s prototype object. For example, try <code>person1.__proto__</code> and <code>person1.__proto__.__proto__</code> to see what the chain looks like in code!</p></div><p>This demonstrates <code>person1.__proto__</code> and <code>person1.__proto__.__proto__</code> structure: <img src="'+p+'" alt="prototype_1"></p><p>Since ECMAScript 2015 we can access an object&#39;s prototype object indirectly via <code>Object.getPrototypeOf(obj)</code>. <img src="'+r+'" alt="prototype_2"></p><h2 id="the-prototype-property-where-inherited-members-are-defined" tabindex="-1">The prototype property: Where inherited members are defined <a class="header-anchor" href="#the-prototype-property-where-inherited-members-are-defined" aria-label="Permalink to &quot;The prototype property: Where inherited members are defined&quot;">​</a></h2><p>我们可以在看到 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer">这里</a> 很多的 Object’s Methods. 为什么这些方法有些是可以被继承的，有些不可以被继承呢？</p><p>The answer is that <strong>the inherited ones are the ones defined on the prototype property</strong> (you could call it a sub-namespace) — that is, the ones that begin with <code>Object.prototype</code>., and not the ones that begin with just <code>Object</code>.</p><p>The prototype property&#39;s value is an object, which is basically a bucket for storing properties and methods that we want to be inherited by objects further down the prototype chain.</p><p>So <code>Object.prototype.watch()</code>, <code>Object.prototype.valueOf()</code>, etc., are available to any object types that inherit from <code>Object.prototype</code>, including new object instances created from the constructor.</p><p><code>Object.is()</code>, <code>Object.keys()</code>, and other members <strong>not</strong> defined inside the prototype bucket are <strong>not</strong> inherited by object instances or object types that inherit from <code>Object.prototype</code>. They are methods/properties available just on the <code>Object()</code>constructor itself.</p><p>So, maybe you will feel strange, <strong>how can you have a method defined on a constructor, which is itself a function?</strong> Well, a function is also a type of object — see the Function() constructor reference if you don&#39;t believe us.</p><ol><li>You can check out existing prototype properties for yourself — go back to our previous example and try entering the following into the JavaScript console:</li></ol><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#7FBBB3;">Person</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">prototype</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>The output won&#39;t show you very much — after all, we haven&#39;t defined anything on our custom constructor&#39;s prototype! By default, a constructor&#39;s prototype always starts empty. Now try the following:</li></ol><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#7FBBB3;">Object</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">prototype</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="'+l+'" alt="prototype_3"></p><p>You&#39;ll see a large number of methods defined on <strong>Object&#39;s prototype property</strong>, which are then available on objects that inherit from Object, as shown earlier.</p><p>You&#39;ll see other examples of prototype chain inheritance all over JavaScript — try looking for the methods and properties defined on the prototype of the <code>String</code>, <code>Date</code>, <code>Number</code>, and <code>Array</code> global objects, for example. These all have a number of members defined on their prototype, which is why for example when you create a string, like this:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E69875;">var</span><span style="color:#D3C6AA;"> myString </span><span style="color:#E69875;">=</span><span style="color:#DBBC7F;"> &#39;This is my string.&#39;</span><span style="color:#D3C6AA;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>myString</code> immediately has a number of useful methods available on it, like <code>split()</code>, <code>indexOf()</code>, <code>replace()</code>, etc.</p><h2 id="revisiting-create" tabindex="-1">Revisiting create() <a class="header-anchor" href="#revisiting-create" aria-label="Permalink to &quot;Revisiting create()&quot;">​</a></h2><p>the <code>Object.create()</code> method can be used to create a new object instance.</p><p>For example, try this in your previous example&#39;s JavaScript console:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#E69875;">var</span><span style="color:#D3C6AA;"> person2 </span><span style="color:#E69875;">=</span><span style="color:#D3C6AA;"> Object</span><span style="color:#859289;">.</span><span style="color:#A7C080;">create</span><span style="color:#D3C6AA;">(person1);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>What <code>create()</code> actually does is to create a new object from a specified prototype object. Here, <code>person2</code> is being created using <code>person1</code> as a prototype object. You can check this by entering the following in the console:</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#D3C6AA;">person2</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">__proto__</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>This will return the <code>person1</code>.</p><p><img src="'+c+`" alt="prototype_4"></p><h2 id="the-constructor-property" tabindex="-1">The constructor property <a class="header-anchor" href="#the-constructor-property" aria-label="Permalink to &quot;The constructor property&quot;">​</a></h2><p>Properties defined on the <strong>Person.prototype property</strong> become available to all the instance objects created using the <strong>Person() constructor</strong>. Hence, the constructor property is also available to both <code>person1</code> and <code>person2</code> objects.</p><p>For example, try these commands in the console:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#D3C6AA;">person1</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">constructor</span></span>
<span class="line"><span style="color:#D3C6AA;">person2</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">constructor</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">// These should both return the Person() constructor, as it contains the original definition of these instances.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="`+i+`" alt="prototype_5"></p><p>The constructor property has other uses. For example, if you have an object instance and you want to return the name of the constructor it is an instance of, you can use the following:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#D3C6AA;">person1</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">constructor</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">name</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">// return &quot;Person&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">Note</p><p>The value of <code>constructor.name</code> can change (due to prototypical inheritance, binding, preprocessors, transpilers, etc.), so for more complex examples you&#39;ll want to use the <code>instanceof</code> operator instead.</p></div><h2 id="modifying-prototypes" tabindex="-1">Modifying prototypes <a class="header-anchor" href="#modifying-prototypes" aria-label="Permalink to &quot;Modifying prototypes&quot;">​</a></h2><p><strong>Question: how the prototype property can be used to add methods to existing constructors?</strong></p><p>很简单，直接添加到<code>constructors</code> 的<code>prototype</code>上即可，例如：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#7FBBB3;">Person</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">prototype</span><span style="color:#859289;">.</span><span style="color:#A7C080;">farewell</span><span style="color:#E69875;"> =</span><span style="color:#E67E80;"> function</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#A7C080;">  alert</span><span style="color:#D3C6AA;">(</span><span style="color:#D699B6;">this</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">first</span><span style="color:#E69875;"> +</span><span style="color:#DBBC7F;"> &#39; has left the building. Bye for now!&#39;</span><span style="color:#D3C6AA;">);</span></span>
<span class="line"><span style="color:#D3C6AA;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样便可以在 <code>Person</code> 的 <code>prototype</code> 上新增方法 <code>farewell</code>。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>In fact, a fairly common pattern for more object definitions is to <strong>define the properties inside the constructor, and the methods on the prototype.</strong> This makes the code easier to read, as the constructor only contains the property definitions, and the methods are split off into separate blocks.</p></div><p>Like This:</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#859289;font-style:italic;">// Constructor with property definitions</span></span>
<span class="line"><span style="color:#E67E80;">function</span><span style="color:#A7C080;"> Test</span><span style="color:#D3C6AA;">(a,</span><span style="color:#D3C6AA;"> b,</span><span style="color:#D3C6AA;"> c,</span><span style="color:#D3C6AA;"> d)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // property definitions</span></span>
<span class="line"><span style="color:#D3C6AA;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">// First method definition</span></span>
<span class="line"><span style="color:#7FBBB3;">Test</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">prototype</span><span style="color:#859289;">.</span><span style="color:#A7C080;">x</span><span style="color:#E69875;"> =</span><span style="color:#E67E80;"> function</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span><span style="color:#E69875;"> ...</span><span style="color:#D3C6AA;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">// Second method definition</span></span>
<span class="line"><span style="color:#7FBBB3;">Test</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">prototype</span><span style="color:#859289;">.</span><span style="color:#A7C080;">y</span><span style="color:#E69875;"> =</span><span style="color:#E67E80;"> function</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span><span style="color:#E69875;"> ...</span><span style="color:#D3C6AA;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">// etc.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><p><a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Object_prototypes" target="_blank" rel="noreferrer">Object prototypes - Learn web development | MDN</a></p>`,63)]))}const A=s(d,[["render",y]]);export{v as __pageData,A as default};
