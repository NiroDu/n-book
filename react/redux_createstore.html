<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>讲讲 Redux createStore 的实现原理 | N-Book</title>
    <meta name="description" content="记录一些技术方面的文章">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/n-book/assets/style.BsaypSZT.css" as="style">
    <link rel="preload stylesheet" href="/n-book/vp-icons.css" as="style">
    
    <script type="module" src="/n-book/assets/app.3fgvfeMo.js"></script>
    <link rel="preload" href="/n-book/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/n-book/assets/chunks/theme.BKwMyCn2.js">
    <link rel="modulepreload" href="/n-book/assets/chunks/framework.D-6U7MZ9.js">
    <link rel="modulepreload" href="/n-book/assets/react_redux_createstore.md.wRAlHiy5.lean.js">
    <link rel="icon" href="/n-book/favicon.ico">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/n-book/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/n-book/logo.png" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>N-Book</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/n-book/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/n-book/typescript/chapter1/readme.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>TypeScript</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/n-book/python/env.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Python</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/NiroDu/n-book" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/NiroDu/n-book" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-8a42e2b4><button data-v-8a42e2b4>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>JavaScript 专栏</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/this_in_js.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>This in JS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/about_js_this.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>JS 中对 this 的理解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/closure.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>闭包</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/inheritance.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>继承</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/prototypes_and_prototype_chains.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>原型与原型链</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/inheritance_and_prototype_chain_1.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>继承与原型链(1)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/inheritance_and_prototype_chain_2.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>继承与原型链(2)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/event_loop.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>事件循环</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/promise.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Promise</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/asynchronous_function.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>异步函数</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/es6_classes.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>ES6 类</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/javascript/iife.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>IIFE</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>React 专栏</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/react/react_basic.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>React 基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/react/redux_basic.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Redux 基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/react/redux_intermediate.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Redux 进阶</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/react/libs_with_react.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Libs with React</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/react/react_ssr.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>从 0 实现 React SSR</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/react/redux_createstore.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Redux createStore 的实现原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/react/react_context.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>React Context 怎么用</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Vue 专栏</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/vue/iis.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>IIS 配置</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Webpack 专栏</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/webpack/webpack_basic.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Webpack 基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/webpack/webpack_intermediate.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Webpack 进阶</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/webpack/webpack_advanced.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Webpack 高级</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>自动化测试</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/testing/basic_principle.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>基本原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/testing/jest_basic.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Jest 基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/testing/jest_advanced.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Jest 进阶</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>性能优化</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/performance/cache.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>浏览器缓存</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>CSS</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/css/2020-05-14-flexbox.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>Flexbox</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>Interview 专栏</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/interview/basic_2018.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>基础题 2018</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/interview/js_question.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>JS 问题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/interview/interview_error.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>面试中遇上的题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/interview/mdn_note.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>MDN 笔记</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b3fd67f8><div class="item" role="button" tabindex="0" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><h2 class="text" data-v-b3fd67f8>其他</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b3fd67f8><span class="vpi-chevron-right caret-icon" data-v-b3fd67f8></span></div></div><div class="items" data-v-b3fd67f8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/other/regular_expression.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>正则表达式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/other/yarn_npm_resource_change.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>包管理器配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b3fd67f8 data-v-b3fd67f8><div class="item" data-v-b3fd67f8><div class="indicator" data-v-b3fd67f8></div><a class="VPLink link link" href="/n-book/other/common_commands.html" data-v-b3fd67f8><!--[--><p class="text" data-v-b3fd67f8>OS常用命令</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>页面导航</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _n-book_react_redux_createstore" data-v-39a288b8><div><h1 id="讲讲-redux-createstore-的实现原理" tabindex="-1">讲讲 Redux createStore 的实现原理 <a class="header-anchor" href="#讲讲-redux-createstore-的实现原理" aria-label="Permalink to &quot;讲讲 Redux createStore 的实现原理&quot;">​</a></h1><p><img src="/n-book/assets/createStore.bw6IBCfg.jpg" alt="createStore"></p><p>createStore 创建一个 Redux store 来以存放应用中所有的 state，应用中应有且仅有一个 store。其中暴露 dispatch, subscribe, getState, replaceReducer 方法。</p><h2 id="基本用法" tabindex="-1">基本用法 <a class="header-anchor" href="#基本用法" aria-label="Permalink to &quot;基本用法&quot;">​</a></h2><p>先看看 createStore 是怎么个用法：</p><p><code>createStore(reducer, [preloadedState], enhancer)</code></p><p><strong>参数</strong></p><p><code>reducer (Function)</code>: A reducing function that returns the next state tree, given the current state tree and an action to handle.(reducer 接收两个参数，分别是当前的 state 树和要处理的 action，返回新的 state 树。)</p><p><code>[preloadedState] (any)</code>: The initial state. You may optionally specify it to hydrate the state from the server in universal apps, or to restore a previously serialized user session. If you produced reducer with combineReducers, this must be a plain object with the same shape as the keys passed to it. Otherwise, you are free to pass anything that your reducer can understand.(初始时的 state。在同构应用中，你可以决定是否把服务端传来的 state hydrate 后传给它，或者从之前保存的用户会话中恢复一个传给它。如果你使用 combineReducers 创建 reducer，它必须是一个普通对象，与传入的 keys 保持同样的结构。否则，你可以自由传入任何 reducer 可理解的内容。)</p><p><code>[enhancer] (Function)</code>: The store enhancer. You may optionally specify it to enhance the store with third-party capabilities such as middleware, time travel, persistence, etc. The only store enhancer that ships with Redux is applyMiddleware().(store 的增强器函数，可以指定为第三方的中间件，时间旅行，持久化 等等，但是这个函数只能用 Redux 提供的 applyMiddleware 函数来生成；)</p><p><strong>返回值</strong></p><p>(Store): An object that holds the complete state of your app. The only way to change its state is by dispatching actions. You may also subscribe to the changes to its state to update the UI.(保存了所有 state 的对象。改变 state 的唯一方法是 dispatch action。你也可以 subscribe 监听 state 的变化，然后更新 UI。)</p><p><strong>示例</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#83C092;">import</span><span style="color:#D3C6AA;"> { createStore } </span><span style="color:#E67E80;">from</span><span style="color:#DBBC7F;"> &quot;redux&quot;</span><span style="color:#D3C6AA;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">// 声明一个reducer</span></span>
<span class="line"><span style="color:#E67E80;">function</span><span style="color:#A7C080;"> todos</span><span style="color:#D3C6AA;">(state</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> [],</span><span style="color:#D3C6AA;"> action)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E69875;">  switch</span><span style="color:#D3C6AA;"> (action</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">type)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E69875;">    case</span><span style="color:#DBBC7F;"> &quot;ADD_TODO&quot;</span><span style="color:#D3C6AA;">:</span></span>
<span class="line"><span style="color:#E67E80;">      return</span><span style="color:#D3C6AA;"> state</span><span style="color:#859289;">.</span><span style="color:#A7C080;">concat</span><span style="color:#D3C6AA;">([action</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">text]);</span></span>
<span class="line"><span style="color:#E69875;">    default</span><span style="color:#D3C6AA;">:</span></span>
<span class="line"><span style="color:#E67E80;">      return</span><span style="color:#D3C6AA;"> state;</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#D3C6AA;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E69875;">let</span><span style="color:#D3C6AA;"> store </span><span style="color:#E69875;">=</span><span style="color:#A7C080;"> createStore</span><span style="color:#D3C6AA;">(todos, [</span><span style="color:#DBBC7F;">&quot;Use Redux&quot;</span><span style="color:#D3C6AA;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D3C6AA;">store</span><span style="color:#859289;">.</span><span style="color:#A7C080;">dispatch</span><span style="color:#D3C6AA;">({</span></span>
<span class="line"><span style="color:#D3C6AA;">  type</span><span style="color:#859289;">:</span><span style="color:#DBBC7F;"> &quot;ADD_TODO&quot;</span><span style="color:#D3C6AA;">,</span></span>
<span class="line"><span style="color:#D3C6AA;">  text</span><span style="color:#859289;">:</span><span style="color:#DBBC7F;"> &quot;Read the docs&quot;</span></span>
<span class="line"><span style="color:#D3C6AA;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D3C6AA;">console</span><span style="color:#859289;">.</span><span style="color:#A7C080;">log</span><span style="color:#D3C6AA;">(store</span><span style="color:#859289;">.</span><span style="color:#A7C080;">getState</span><span style="color:#D3C6AA;">());</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">// [ &#39;Use Redux&#39;, &#39;Read the docs&#39; ]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="源码及分析" tabindex="-1">源码及分析 <a class="header-anchor" href="#源码及分析" aria-label="Permalink to &quot;源码及分析&quot;">​</a></h2><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#859289;font-style:italic;">// 大体框架</span></span>
<span class="line"><span style="color:#83C092;">export</span><span style="color:#E69875;"> const</span><span style="color:#D3C6AA;"> ActionTypes </span><span style="color:#E69875;">=</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">  INIT</span><span style="color:#859289;">:</span><span style="color:#DBBC7F;"> &quot;@@redux/INIT&quot;</span></span>
<span class="line"><span style="color:#D3C6AA;">};</span></span>
<span class="line"><span style="color:#83C092;">export</span><span style="color:#E67E80;"> default</span><span style="color:#E67E80;"> function</span><span style="color:#A7C080;"> createStore</span><span style="color:#D3C6AA;">(reducer,</span><span style="color:#D3C6AA;"> preloadedState,</span><span style="color:#D3C6AA;"> enhancer)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  //...初始条件的判断和设定</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> getState</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // getState方法的实现</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> subscribe</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // subscribe方法的实现</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> dispatch</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // dispatch方法的实现</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> replaceReducer</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // replaceReducer方法的实现</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> observable</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // observable方法的实现</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // (源码中关于observable的部分可以忽略，这个是redux内部使用的。我们在开发中几乎几乎用不到)</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // store被创建后，自动分发一个&#39;INIT&#39; action。渲染出初始化的state树。</span></span>
<span class="line"><span style="color:#A7C080;">  dispatch</span><span style="color:#D3C6AA;">({</span><span style="color:#D3C6AA;"> type</span><span style="color:#859289;">:</span><span style="color:#D3C6AA;"> ActionTypes</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">INIT</span><span style="color:#D3C6AA;"> });</span></span>
<span class="line"><span style="color:#E67E80;">  return</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">    dispatch,</span></span>
<span class="line"><span style="color:#D3C6AA;">    subscribe,</span></span>
<span class="line"><span style="color:#D3C6AA;">    getState,</span></span>
<span class="line"><span style="color:#D3C6AA;">    replaceReducer</span></span>
<span class="line"><span style="color:#D3C6AA;">  };</span></span>
<span class="line"><span style="color:#D3C6AA;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>完整源码</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki everforest-dark vp-code" tabindex="0"><code><span class="line"><span style="color:#859289;font-style:italic;">// 首先定义了一个 ActionTypes 对象，它是一个 action，是一个 Redux 的私有 action，不允许外界触发，用来初始化 Store 的状态树和改变 reducers 后初始化 Store 的状态树。</span></span>
<span class="line"><span style="color:#83C092;">export</span><span style="color:#E69875;"> const</span><span style="color:#D3C6AA;"> ActionTypes </span><span style="color:#E69875;">=</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">  INIT</span><span style="color:#859289;">:</span><span style="color:#DBBC7F;"> &quot;@@redux/INIT&quot;</span></span>
<span class="line"><span style="color:#D3C6AA;">};</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#859289;font-style:italic;"> * 创建 store, 参数 reducer, state 以及中间件</span></span>
<span class="line"><span style="color:#859289;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#83C092;">export</span><span style="color:#E67E80;"> default</span><span style="color:#E67E80;"> function</span><span style="color:#A7C080;"> createStore</span><span style="color:#D3C6AA;">(reducer,</span><span style="color:#D3C6AA;"> preloadedState,</span><span style="color:#D3C6AA;"> enhancer)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 在平常的使用中，我们一般会省略第二个参数。比如，当我们需要使用redux中间件的时候，就会像第三个参数传递一个applyMiddleware()[返回值是一个function]。</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 如果，我们没有初始状态，则会省略第二个参数。这个时候，我们的函数调用形式为：</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // const store = createStore(reducer, applyMiddleware(...))</span></span>
<span class="line"><span style="color:#E67E80;">  if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E67E80;">typeof</span><span style="color:#D3C6AA;"> preloadedState</span><span style="color:#E69875;"> ===</span><span style="color:#DBBC7F;"> &quot;function&quot;</span><span style="color:#E69875;"> &amp;&amp;</span><span style="color:#E67E80;"> typeof</span><span style="color:#D3C6AA;"> enhancer</span><span style="color:#E69875;"> ===</span><span style="color:#DBBC7F;"> &quot;undefined&quot;</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">    enhancer</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> preloadedState;</span></span>
<span class="line"><span style="color:#D3C6AA;">    preloadedState</span><span style="color:#E69875;"> =</span><span style="color:#D699B6;"> undefined</span><span style="color:#D3C6AA;">;</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 如果我们指定了reducer增强器enhancer</span></span>
<span class="line"><span style="color:#E67E80;">  if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E67E80;">typeof</span><span style="color:#D3C6AA;"> enhancer</span><span style="color:#E69875;"> !==</span><span style="color:#DBBC7F;"> &quot;undefined&quot;</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // enhancer必须是一个函数</span></span>
<span class="line"><span style="color:#E67E80;">    if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E67E80;">typeof</span><span style="color:#D3C6AA;"> enhancer</span><span style="color:#E69875;"> !==</span><span style="color:#DBBC7F;"> &quot;function&quot;</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">      throw</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Error</span><span style="color:#D3C6AA;">(</span><span style="color:#DBBC7F;">&quot;Expected the enhancer to be a function.&quot;</span><span style="color:#D3C6AA;">);</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 这个函数接收createStore作为参数，并且返回一个函数，这个函数接收的参数是reducer,preloadedState</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 直接返回经过enhancer包装的对象</span></span>
<span class="line"><span style="color:#E67E80;">    return</span><span style="color:#A7C080;"> enhancer</span><span style="color:#D3C6AA;">(createStore)(reducer,</span><span style="color:#D3C6AA;"> preloadedState);</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A7C080;">  </span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 要求传递给createStore的第一个参数必须是一个函数</span></span>
<span class="line"><span style="color:#E67E80;">  if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E67E80;">typeof</span><span style="color:#D3C6AA;"> reducer</span><span style="color:#E69875;"> !==</span><span style="color:#DBBC7F;"> &quot;function&quot;</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">    throw</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Error</span><span style="color:#D3C6AA;">(</span><span style="color:#DBBC7F;">&quot;Expected the reducer to be a function.&quot;</span><span style="color:#D3C6AA;">);</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 保存初始的reducer</span></span>
<span class="line"><span style="color:#E69875;">  let</span><span style="color:#D3C6AA;"> currentReducer</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> reducer</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 保存初始的state</span></span>
<span class="line"><span style="color:#E69875;">  let</span><span style="color:#D3C6AA;"> currentState</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> preloadedState</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 保存所有的事件监听器</span></span>
<span class="line"><span style="color:#E69875;">  let</span><span style="color:#D3C6AA;"> currentListeners</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> []</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 获取当前监听器的一个副本(相同的引用)</span></span>
<span class="line"><span style="color:#E69875;">  let</span><span style="color:#D3C6AA;"> nextListeners</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> currentListeners</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 是否正在派发action</span></span>
<span class="line"><span style="color:#E69875;">  let</span><span style="color:#D3C6AA;"> isDispatching</span><span style="color:#E69875;"> =</span><span style="color:#D699B6;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 这个函数可以根据当前监听函数的列表生成新的下一个监听函数列表引用</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 如果nextListeners和currentListeners具有相同的引用，则获取一份当前事件监听器集合的一个副本保存到nextListeners中</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> ensureCanMutateNextListeners</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">    if</span><span style="color:#D3C6AA;"> (nextListeners</span><span style="color:#E69875;"> ===</span><span style="color:#D3C6AA;"> currentListeners)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">      nextListeners</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> currentListeners</span><span style="color:#859289;">.</span><span style="color:#A7C080;">slice</span><span style="color:#D3C6AA;">();</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 为什么要维护两份事件监听器列表(nextListeners,currentListeners)??</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 下面我们来解释</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 直接返回当前store的state</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> getState</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">    return</span><span style="color:#D3C6AA;"> currentState;</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 订阅事件，返回移除订阅函数</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> subscribe</span><span style="color:#D3C6AA;">(listener)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 事件监听器必须是函数，否则会抛出异常</span></span>
<span class="line"><span style="color:#E67E80;">    if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E67E80;">typeof</span><span style="color:#D3C6AA;"> listener</span><span style="color:#E69875;"> !==</span><span style="color:#DBBC7F;"> &quot;function&quot;</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">      throw</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Error</span><span style="color:#D3C6AA;">(</span><span style="color:#DBBC7F;">&quot;Expected listener to be a function.&quot;</span><span style="color:#D3C6AA;">);</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 这个事件监听器是否已经被取消的标志</span></span>
<span class="line"><span style="color:#E69875;">    let</span><span style="color:#D3C6AA;"> isSubscribed</span><span style="color:#E69875;"> =</span><span style="color:#D699B6;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 调用这个函数的结果就是生成一份当前事件监听器的一个副本保存到nextListeners中</span></span>
<span class="line"><span style="color:#A7C080;">    ensureCanMutateNextListeners</span><span style="color:#D3C6AA;">()</span></span>
<span class="line"><span style="color:#A7C080;">    </span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 将新的事件监听器添加到nextListeners中</span></span>
<span class="line"><span style="color:#D3C6AA;">    nextListeners</span><span style="color:#859289;">.</span><span style="color:#A7C080;">push</span><span style="color:#D3C6AA;">(listener)</span></span>
<span class="line"><span style="color:#A7C080;">    </span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 返回一个取消监听的函数</span></span>
<span class="line"><span style="color:#E67E80;">    return</span><span style="color:#E67E80;"> function</span><span style="color:#A7C080;"> unsubscribe</span><span style="color:#D3C6AA;">()</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 如果这个监听器已经被取消了，则直接return</span></span>
<span class="line"><span style="color:#E67E80;">      if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E69875;">!</span><span style="color:#D3C6AA;">isSubscribed)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">        return</span><span style="color:#D3C6AA;">;</span></span>
<span class="line"><span style="color:#D3C6AA;">      }</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 将监听器是否取消的标志设置为false</span></span>
<span class="line"><span style="color:#D3C6AA;">      isSubscribed</span><span style="color:#E69875;"> =</span><span style="color:#D699B6;"> false</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 再次生成一份事件监听器集合的副本</span></span>
<span class="line"><span style="color:#A7C080;">      ensureCanMutateNextListeners</span><span style="color:#D3C6AA;">()</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 获取到需要取消的事件监听器的索引</span></span>
<span class="line"><span style="color:#E69875;">      const</span><span style="color:#D3C6AA;"> index</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> nextListeners</span><span style="color:#859289;">.</span><span style="color:#A7C080;">indexOf</span><span style="color:#D3C6AA;">(listener)</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 从事件监听器集合中删除这个事件监听器</span></span>
<span class="line"><span style="color:#D3C6AA;">      nextListeners</span><span style="color:#859289;">.</span><span style="color:#A7C080;">splice</span><span style="color:#D3C6AA;">(index,</span><span style="color:#D699B6;"> 1</span><span style="color:#D3C6AA;">)</span></span>
<span class="line"><span style="color:#D3C6AA;">    };</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 从subscribe方法的源码中可以看出，每次在进行监听器的添加/删除之前，都会基于当前的监听器集合生成一个副本保存到nextListeners中。</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 下面我们继续看dispatch的源码:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">  // 执行 reducer，并触发订阅事件</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> dispatch</span><span style="color:#D3C6AA;">(action)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // https://lodash.com/docs#isPlainObject</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // dispatch的参数就是我们需要派发的action，一定要保证这个action是一个纯粹的对象</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 如果不是一个纯粹的对象，则会抛出异常。</span></span>
<span class="line"><span style="color:#E67E80;">    if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E69875;">!</span><span style="color:#A7C080;">isPlainObject</span><span style="color:#D3C6AA;">(action))</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">      throw</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Error</span><span style="color:#D3C6AA;">(</span></span>
<span class="line"><span style="color:#DBBC7F;">        &quot;Actions must be plain objects. &quot;</span><span style="color:#E69875;"> +</span></span>
<span class="line"><span style="color:#DBBC7F;">          &quot;Use custom middleware for async actions.&quot;</span></span>
<span class="line"><span style="color:#D3C6AA;">      );</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 判断 action 是否有 type｛必须｝ 属性</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 派发的action必须有一个type属性(我们可以将这个属性认为就是action的身份证，这样redux才知道你派发的是哪个action，你需要做什么，该怎么为你做)</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 如果没有这个属性则会抛出异常</span></span>
<span class="line"><span style="color:#E67E80;">    if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E67E80;">typeof</span><span style="color:#D3C6AA;"> action</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">type</span><span style="color:#E69875;"> ===</span><span style="color:#DBBC7F;"> &quot;undefined&quot;</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">      throw</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Error</span><span style="color:#D3C6AA;">(</span></span>
<span class="line"><span style="color:#DBBC7F;">        &#39;Actions may not have an undefined &quot;type&quot; property. &#39;</span><span style="color:#E69875;"> +</span></span>
<span class="line"><span style="color:#DBBC7F;">          &quot;Have you misspelled a constant?&quot;</span></span>
<span class="line"><span style="color:#D3C6AA;">      );</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 如果正在 dispatch 则抛出错误</span></span>
<span class="line"><span style="color:#E67E80;">    if</span><span style="color:#D3C6AA;"> (isDispatching)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">      throw</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Error</span><span style="color:#D3C6AA;">(</span><span style="color:#DBBC7F;">&quot;Reducers may not dispatch actions.&quot;</span><span style="color:#D3C6AA;">);</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 对抛出 error 的兼容，但无论如何都会继续执行 isDispatching = false 的操作</span></span>
<span class="line"><span style="color:#E67E80;">    try</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">      isDispatching</span><span style="color:#E69875;"> =</span><span style="color:#D699B6;"> true</span><span style="color:#D3C6AA;">;</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 派发action</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 实质就是将当前的state和你需要派发的action传递给reducer函数并返回一个新的state</span></span>
<span class="line"><span style="color:#D3C6AA;">      currentState</span><span style="color:#E69875;"> =</span><span style="color:#A7C080;"> currentReducer</span><span style="color:#D3C6AA;">(currentState,</span><span style="color:#D3C6AA;"> action);</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span><span style="color:#E67E80;"> finally</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">      isDispatching</span><span style="color:#E69875;"> =</span><span style="color:#D699B6;"> false</span><span style="color:#D3C6AA;">;</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // 又多了一份事件监听器的列表，简单的说一下这三份列表的作用</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // nextListeners: 保存这次dispatch后，需要触发的所有事件监听器的列表</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // currentListeners: 保存一份nextListeners列表的副本</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    // listeners: 需要执行的列表</span></span>
<span class="line"><span style="color:#E69875;">    const</span><span style="color:#D3C6AA;"> listeners</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> currentListeners</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> nextListeners</span></span>
<span class="line"><span style="color:#E67E80;">    for</span><span style="color:#D3C6AA;"> (</span><span style="color:#E69875;">let</span><span style="color:#D3C6AA;"> i</span><span style="color:#E69875;"> =</span><span style="color:#D699B6;"> 0</span><span style="color:#D3C6AA;">;</span><span style="color:#D3C6AA;"> i</span><span style="color:#E69875;"> &lt;</span><span style="color:#D3C6AA;"> listeners</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">length;</span><span style="color:#D3C6AA;"> i</span><span style="color:#E69875;">++</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E69875;">      const</span><span style="color:#D3C6AA;"> listener</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> listeners[i]</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">      // 调用所有的事件监听器</span></span>
<span class="line"><span style="color:#A7C080;">      listener</span><span style="color:#D3C6AA;">()</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">    //  dispatch的返回值也是十分重要的，如果没有这个返回值，就不可能引入强大的中间件机制。</span></span>
<span class="line"><span style="color:#E67E80;">    return</span><span style="color:#D3C6AA;"> action;</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">  /**</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">   * 动态替换 reducer</span></span>
<span class="line"><span style="color:#859289;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#E67E80;">  function</span><span style="color:#A7C080;"> replaceReducer</span><span style="color:#D3C6AA;">(nextReducer)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">    if</span><span style="color:#D3C6AA;"> (</span><span style="color:#E67E80;">typeof</span><span style="color:#D3C6AA;"> nextReducer</span><span style="color:#E69875;"> !==</span><span style="color:#DBBC7F;"> &quot;function&quot;</span><span style="color:#D3C6AA;">)</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#E67E80;">      throw</span><span style="color:#E67E80;"> new</span><span style="color:#A7C080;"> Error</span><span style="color:#D3C6AA;">(</span><span style="color:#DBBC7F;">&quot;Expected the nextReducer to be a function.&quot;</span><span style="color:#D3C6AA;">);</span></span>
<span class="line"><span style="color:#D3C6AA;">    }</span></span>
<span class="line"><span style="color:#D3C6AA;">    currentReducer</span><span style="color:#E69875;"> =</span><span style="color:#D3C6AA;"> nextReducer;</span></span>
<span class="line"><span style="color:#A7C080;">    dispatch</span><span style="color:#D3C6AA;">({</span><span style="color:#D3C6AA;"> type</span><span style="color:#859289;">:</span><span style="color:#D3C6AA;"> ActionTypes</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">INIT</span><span style="color:#D3C6AA;"> });</span></span>
<span class="line"><span style="color:#D3C6AA;">  }</span></span>
<span class="line"><span style="color:#A7C080;">  dispatch</span><span style="color:#D3C6AA;">({</span><span style="color:#D3C6AA;"> type</span><span style="color:#859289;">:</span><span style="color:#D3C6AA;"> ActionTypes</span><span style="color:#859289;">.</span><span style="color:#D3C6AA;">INIT</span><span style="color:#D3C6AA;"> });</span></span>
<span class="line"><span style="color:#E67E80;">  return</span><span style="color:#D3C6AA;"> {</span></span>
<span class="line"><span style="color:#D3C6AA;">    dispatch,</span></span>
<span class="line"><span style="color:#D3C6AA;">    subscribe,</span></span>
<span class="line"><span style="color:#D3C6AA;">    getState,</span></span>
<span class="line"><span style="color:#D3C6AA;">    replaceReducer</span></span>
<span class="line"><span style="color:#D3C6AA;">  };</span></span>
<span class="line"><span style="color:#D3C6AA;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br></div></div><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><p><a href="https://segmentfault.com/a/1190000011835213" target="_blank" rel="noreferrer">redux 源码解读－－createStore 源码解析</a></p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/NiroDu/n-book/edit/main/react/redux_createstore.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> 编辑此页<!--]--></a></div><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>上次更新: <time datetime="2019-03-19T04:35:48.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/n-book/react/react_ssr.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>从 0 实现 React SSR</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/n-book/react/react_context.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>React Context 怎么用</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"css_2020-05-14-flexbox.md\":\"BIhdvDXj\",\"index.md\":\"DcN2Cxbj\",\"interview_basic_2018.md\":\"BlUth8lg\",\"interview_interview_error.md\":\"BtdI3fDP\",\"interview_js_question.md\":\"YD1k4SA2\",\"interview_mdn_note.md\":\"Bt8G8pDG\",\"javascript_about_js_this.md\":\"BGV8bhJh\",\"javascript_asynchronous_function.md\":\"DjtrnsEp\",\"javascript_closure.md\":\"DZqJEaYn\",\"javascript_es6_classes.md\":\"DnupT7v8\",\"javascript_event_loop.md\":\"0fHPG5i2\",\"javascript_iife.md\":\"DgPBAFOs\",\"javascript_inheritance.md\":\"DHvj8N1e\",\"javascript_inheritance_and_prototype_chain_1.md\":\"DonCRkkQ\",\"javascript_inheritance_and_prototype_chain_2.md\":\"C7kUrkNa\",\"javascript_promise.md\":\"Dbxydcnj\",\"javascript_prototypes_and_prototype_chains.md\":\"B6bFnu6R\",\"javascript_this_in_js.md\":\"0pw0c2le\",\"other_common_commands.md\":\"Dq4MPkEo\",\"other_docker.md\":\"CcggCdLS\",\"other_regular_expression.md\":\"BIxIwjW9\",\"other_yarn_npm_resource_change.md\":\"e57Yhg_k\",\"performance_cache.md\":\"CsZbkYm4\",\"python_env.md\":\"XS82VuWn\",\"python_grammer.md\":\"zG1J00fQ\",\"python_python3_grammer_wake_up.md\":\"8O3kCqwJ\",\"python_readme.md\":\"BLOyDyUl\",\"react_libs_with_react.md\":\"DdnGkI73\",\"react_react_basic.md\":\"DyDzI6rU\",\"react_react_context.md\":\"D43HUuyK\",\"react_react_ssr.md\":\"DYQE5o1s\",\"react_redux_basic.md\":\"BYmTfA4z\",\"react_redux_createstore.md\":\"wRAlHiy5\",\"react_redux_intermediate.md\":\"CxLFfkUe\",\"testing_basic_principle.md\":\"C-586iHi\",\"testing_jest_advanced.md\":\"BjpxhV8_\",\"testing_jest_basic.md\":\"B0_p8hJC\",\"typescript_basic_usage.md\":\"Bzf1D8wg\",\"typescript_chapter10_auth.md\":\"C4K6JMUZ\",\"typescript_chapter10_baseurl.md\":\"C-c-Gybn\",\"typescript_chapter10_paramsserializer.md\":\"8fViwrHr\",\"typescript_chapter10_static.md\":\"BO5SQsiY\",\"typescript_chapter10_upload-download.md\":\"B56QnjvD\",\"typescript_chapter10_validatestatus.md\":\"BdQ4i_il\",\"typescript_chapter10_withcredentials.md\":\"DJqr2MjC\",\"typescript_chapter10_xsrf.md\":\"BqgRZawm\",\"typescript_chapter11_cancel.md\":\"BpyGlog5\",\"typescript_chapter11_headers.md\":\"7Yw8vokH\",\"typescript_chapter11_helpers.md\":\"DLhP1hiy\",\"typescript_chapter11_instance.md\":\"UsgIDOOj\",\"typescript_chapter11_interceptor.md\":\"Dl2Rc4s1\",\"typescript_chapter11_jest.md\":\"kNwofVql\",\"typescript_chapter11_mergeconfig.md\":\"DUHrIKJU\",\"typescript_chapter11_more.md\":\"VZXkeWpZ\",\"typescript_chapter11_preface.md\":\"CPK96t-S\",\"typescript_chapter11_requests.md\":\"QTIiMNOA\",\"typescript_chapter12_build-deploy.md\":\"DRCcuAlJ\",\"typescript_chapter12_demo.md\":\"BxsbN62m\",\"typescript_chapter13_summary.md\":\"Bzhd0U7l\",\"typescript_chapter1_install.md\":\"BrmSwGrl\",\"typescript_chapter1_readme.md\":\"PE1jm4ox\",\"typescript_chapter1_start.md\":\"BMlub9Df\",\"typescript_chapter2_advance.md\":\"DTjz3t2e\",\"typescript_chapter2_class.md\":\"B8ojUQPq\",\"typescript_chapter2_declare.md\":\"93Y1j-J8\",\"typescript_chapter2_function.md\":\"212v7WXL\",\"typescript_chapter2_generic.md\":\"CF1m68hZ\",\"typescript_chapter2_inference.md\":\"DqCzE6N2\",\"typescript_chapter2_interface.md\":\"BFAuVK5B\",\"typescript_chapter2_type.md\":\"K38dq2rX\",\"typescript_chapter3_base.md\":\"fiZK-fc1\",\"typescript_chapter3_init.md\":\"CRvhEAhY\",\"typescript_chapter3_require.md\":\"CMBYG-8T\",\"typescript_chapter4_data.md\":\"ltd1o1tp\",\"typescript_chapter4_header.md\":\"Gkk3yiBe\",\"typescript_chapter4_response-data.md\":\"Csp__r9K\",\"typescript_chapter4_response-header.md\":\"CyiQDmnp\",\"typescript_chapter4_response.md\":\"BaE8uKmD\",\"typescript_chapter4_url.md\":\"DeWUvnDn\",\"typescript_chapter5_enhance.md\":\"DKvRI2ws\",\"typescript_chapter5_error.md\":\"DII5wPA6\",\"typescript_chapter6_extend.md\":\"Cc6zc-4Z\",\"typescript_chapter6_generic.md\":\"DidEXMrI\",\"typescript_chapter6_overload.md\":\"Cc-TQllU\",\"typescript_chapter7_interceptor.md\":\"Dh45L5Xe\",\"typescript_chapter8_create.md\":\"gHfqbFEx\",\"typescript_chapter8_merge.md\":\"DcaKtfxn\",\"typescript_chapter8_transform.md\":\"B0DvCukL\",\"typescript_chapter9_cancel.md\":\"CkkqB8t4\",\"typescript_intermediate_usage.md\":\"iA5xDqc4\",\"typescript_readme.md\":\"BQGeWEn-\",\"typescript_tips.md\":\"DawUi41n\",\"vue_iis.md\":\"Bsuphomd\",\"webpack_webpack_advanced.md\":\"xH0K_rWu\",\"webpack_webpack_basic.md\":\"kx09MN8d\",\"webpack_webpack_intermediate.md\":\"R7V9e2CD\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"N-Book\",\"description\":\"记录一些技术方面的文章\",\"base\":\"/n-book/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.png\",\"outline\":{\"level\":[1,4],\"label\":\"页面导航\"},\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"TypeScript\",\"link\":\"/typescript/chapter1/readme\"},{\"text\":\"Python\",\"link\":\"/python/env\"}],\"sidebar\":{\"/\":[{\"text\":\"JavaScript 专栏\",\"collapsed\":true,\"items\":[{\"text\":\"This in JS\",\"link\":\"/javascript/this_in_js\"},{\"text\":\"JS 中对 this 的理解\",\"link\":\"/javascript/about_js_this\"},{\"text\":\"闭包\",\"link\":\"/javascript/closure\"},{\"text\":\"继承\",\"link\":\"/javascript/inheritance\"},{\"text\":\"原型与原型链\",\"link\":\"/javascript/prototypes_and_prototype_chains\"},{\"text\":\"继承与原型链(1)\",\"link\":\"/javascript/inheritance_and_prototype_chain_1\"},{\"text\":\"继承与原型链(2)\",\"link\":\"/javascript/inheritance_and_prototype_chain_2\"},{\"text\":\"事件循环\",\"link\":\"/javascript/event_loop\"},{\"text\":\"Promise\",\"link\":\"/javascript/promise\"},{\"text\":\"异步函数\",\"link\":\"/javascript/asynchronous_function\"},{\"text\":\"ES6 类\",\"link\":\"/javascript/es6_classes\"},{\"text\":\"IIFE\",\"link\":\"/javascript/iife\"}]},{\"text\":\"React 专栏\",\"collapsed\":true,\"items\":[{\"text\":\"React 基础\",\"link\":\"/react/react_basic\"},{\"text\":\"Redux 基础\",\"link\":\"/react/redux_basic\"},{\"text\":\"Redux 进阶\",\"link\":\"/react/redux_intermediate\"},{\"text\":\"Libs with React\",\"link\":\"/react/libs_with_react\"},{\"text\":\"从 0 实现 React SSR\",\"link\":\"/react/react_ssr\"},{\"text\":\"Redux createStore 的实现原理\",\"link\":\"/react/redux_createstore\"},{\"text\":\"React Context 怎么用\",\"link\":\"/react/react_context\"}]},{\"text\":\"Vue 专栏\",\"collapsed\":true,\"items\":[{\"text\":\"IIS 配置\",\"link\":\"/vue/iis\"}]},{\"text\":\"Webpack 专栏\",\"collapsed\":true,\"items\":[{\"text\":\"Webpack 基础\",\"link\":\"/webpack/webpack_basic\"},{\"text\":\"Webpack 进阶\",\"link\":\"/webpack/webpack_intermediate\"},{\"text\":\"Webpack 高级\",\"link\":\"/webpack/webpack_advanced\"}]},{\"text\":\"自动化测试\",\"collapsed\":true,\"items\":[{\"text\":\"基本原理\",\"link\":\"/testing/basic_principle\"},{\"text\":\"Jest 基础\",\"link\":\"/testing/jest_basic\"},{\"text\":\"Jest 进阶\",\"link\":\"/testing/jest_advanced\"}]},{\"text\":\"性能优化\",\"collapsed\":true,\"items\":[{\"text\":\"浏览器缓存\",\"link\":\"/performance/cache\"}]},{\"text\":\"CSS\",\"collapsed\":true,\"items\":[{\"text\":\"Flexbox\",\"link\":\"/css/2020-05-14-flexbox\"}]},{\"text\":\"Interview 专栏\",\"collapsed\":true,\"items\":[{\"text\":\"基础题 2018\",\"link\":\"/interview/basic_2018\"},{\"text\":\"JS 问题\",\"link\":\"/interview/js_question\"},{\"text\":\"面试中遇上的题\",\"link\":\"/interview/interview_error\"},{\"text\":\"MDN 笔记\",\"link\":\"/interview/mdn_note\"}]},{\"text\":\"其他\",\"collapsed\":true,\"items\":[{\"text\":\"正则表达式\",\"link\":\"/other/regular_expression\"},{\"text\":\"包管理器配置\",\"link\":\"/other/yarn_npm_resource_change\"},{\"text\":\"OS常用命令\",\"link\":\"/other/common_commands\"}]}],\"/typescript/\":[{\"text\":\"Once\",\"collapsed\":true,\"items\":[{\"text\":\"基础用法\",\"link\":\"/typescript/basic_usage\"},{\"text\":\"中级用法\",\"link\":\"/typescript/intermediate_usage\"},{\"text\":\"技巧总结\",\"link\":\"/typescript/tips\"}]},{\"text\":\"初识 TypeScript\",\"collapsed\":true,\"items\":[{\"text\":\"Introduction\",\"link\":\"/typescript/chapter1/README\"},{\"text\":\"安装\",\"link\":\"/typescript/chapter1/install\"},{\"text\":\"开始\",\"link\":\"/typescript/chapter1/start\"}]},{\"text\":\"TypeScript 常用语法\",\"collapsed\":true,\"items\":[{\"text\":\"类型\",\"link\":\"/typescript/chapter2/type\"},{\"text\":\"声明\",\"link\":\"/typescript/chapter2/declare\"},{\"text\":\"接口\",\"link\":\"/typescript/chapter2/interface\"},{\"text\":\"类\",\"link\":\"/typescript/chapter2/class\"},{\"text\":\"函数\",\"link\":\"/typescript/chapter2/function\"},{\"text\":\"泛型\",\"link\":\"/typescript/chapter2/generic\"},{\"text\":\"类型推断\",\"link\":\"/typescript/chapter2/inference\"},{\"text\":\"高级用法\",\"link\":\"/typescript/chapter2/advance\"}]},{\"text\":\"ts-axios 项目初始化\",\"collapsed\":true,\"items\":[{\"text\":\"需求分析\",\"link\":\"/typescript/chapter3/require\"},{\"text\":\"初始化\",\"link\":\"/typescript/chapter3/init\"},{\"text\":\"基础配置\",\"link\":\"/typescript/chapter3/base\"}]},{\"text\":\"ts-axios 基础功能实现\",\"collapsed\":true,\"items\":[{\"text\":\"URL 处理\",\"link\":\"/typescript/chapter4/url\"},{\"text\":\"数据处理\",\"link\":\"/typescript/chapter4/data\"},{\"text\":\"请求头处理\",\"link\":\"/typescript/chapter4/header\"},{\"text\":\"响应处理\",\"link\":\"/typescript/chapter4/response\"},{\"text\":\"响应头处理\",\"link\":\"/typescript/chapter4/response-header\"},{\"text\":\"响应数据处理\",\"link\":\"/typescript/chapter4/response-data\"}]},{\"text\":\"ts-axios 异常情况处理\",\"collapsed\":true,\"items\":[{\"text\":\"错误处理\",\"link\":\"/typescript/chapter5/error\"},{\"text\":\"功能增强\",\"link\":\"/typescript/chapter5/enhance\"}]},{\"text\":\"ts-axios 接口扩展\",\"collapsed\":true,\"items\":[{\"text\":\"接口扩展\",\"link\":\"/typescript/chapter6/extend\"},{\"text\":\"函数重载\",\"link\":\"/typescript/chapter6/overload\"},{\"text\":\"泛型接口\",\"link\":\"/typescript/chapter6/generic\"}]},{\"text\":\"ts-axios 拦截器实现\",\"collapsed\":true,\"items\":[{\"text\":\"拦截器\",\"link\":\"/typescript/chapter7/interceptor\"}]},{\"text\":\"ts-axios 配置化实现\",\"collapsed\":true,\"items\":[{\"text\":\"配置合并\",\"link\":\"/typescript/chapter8/merge\"},{\"text\":\"数据转换\",\"link\":\"/typescript/chapter8/transform\"},{\"text\":\"实例创建\",\"link\":\"/typescript/chapter8/create\"}]},{\"text\":\"ts-axios 取消功能实现\",\"collapsed\":true,\"items\":[{\"text\":\"取消功能\",\"link\":\"/typescript/chapter9/cancel\"}]},{\"text\":\"ts-axios 更多功能实现\",\"collapsed\":true,\"items\":[{\"text\":\"凭证配置\",\"link\":\"/typescript/chapter10/withCredentials\"},{\"text\":\"XSRF 防护\",\"link\":\"/typescript/chapter10/xsrf\"},{\"text\":\"上传下载\",\"link\":\"/typescript/chapter10/upload-download\"},{\"text\":\"身份认证\",\"link\":\"/typescript/chapter10/auth\"},{\"text\":\"状态验证\",\"link\":\"/typescript/chapter10/validateStatus\"},{\"text\":\"参数序列化\",\"link\":\"/typescript/chapter10/paramsSerializer\"},{\"text\":\"基础 URL\",\"link\":\"/typescript/chapter10/baseURL\"},{\"text\":\"静态方法\",\"link\":\"/typescript/chapter10/static\"}]},{\"text\":\"ts-axios 单元测试\",\"collapsed\":true,\"items\":[{\"text\":\"前言\",\"link\":\"/typescript/chapter11/preface\"},{\"text\":\"Jest 配置\",\"link\":\"/typescript/chapter11/jest\"},{\"text\":\"辅助函数测试\",\"link\":\"/typescript/chapter11/helpers\"},{\"text\":\"请求测试\",\"link\":\"/typescript/chapter11/requests\"},{\"text\":\"请求头测试\",\"link\":\"/typescript/chapter11/headers\"},{\"text\":\"实例测试\",\"link\":\"/typescript/chapter11/instance\"},{\"text\":\"拦截器测试\",\"link\":\"/typescript/chapter11/interceptor\"},{\"text\":\"配置合并测试\",\"link\":\"/typescript/chapter11/mergeConfig\"},{\"text\":\"取消功能测试\",\"link\":\"/typescript/chapter11/cancel\"},{\"text\":\"更多功能测试\",\"link\":\"/typescript/chapter11/more\"}]},{\"text\":\"ts-axios 部署与发布\",\"collapsed\":true,\"items\":[{\"text\":\"构建部署\",\"link\":\"/typescript/chapter12/build-deploy\"},{\"text\":\"示例演示\",\"link\":\"/typescript/chapter12/demo\"}]}],\"/python/\":[{\"text\":\"语法速学\",\"collapsed\":false,\"items\":[{\"text\":\"环境配置\",\"link\":\"/python/env\"},{\"text\":\"Python3 语法速成\",\"link\":\"/python/python3_grammer_wake_up\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/NiroDu/n-book\"}],\"editLink\":{\"pattern\":\"https://github.com/NiroDu/n-book/edit/main/:path\",\"text\":\"编辑此页\"},\"lastUpdated\":{\"text\":\"上次更新\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>